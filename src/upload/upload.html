<html>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

<script type="text/javascript">
$.ajax({
type: "POST",
url: 'https://admin.abroadwith.com/users/login',
contentType: "application/json",
data: JSON.stringify({email:"simple@email.com",password:"rightPASS"}),
xhrFields: {
            withCredentials: true
        },
success: function (JWT) {

  console.log(JWT);
  localStorage.setItem('JWT', JWT.token);

}});
$(document).ready(function()
{
    $("#uploadBtn").click(function()
    {
        $('#user_upload').each(function(index, value)
        {
            var file = value.files;
            if(file)
            {
                var formData = new FormData();
                var token = JSON.parse(atob(localStorage.getItem('JWT').split('.')[1]));

            		for(var f = 0; f < file.length; f++){
            			formData.append('photos', file[f]);
            		}
                $.ajax({
                  url : 'http://localhost:3000/upload/users/'+token.rid+'/photo',
                  type : 'POST',
                  data : formData,
                  cache : false,
                  contentType : false,
                  processData : false,
                  beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('JWT'))},
                  success : function(data, textStatus, jqXHR) {
                        var message = jqXHR.responseText;
                        $("#messages").append("<li>" + message + "</li>");
                  },
                  error : function(jqXHR, textStatus, errorThrown) {
                        $("#messages").append("<li style='color: red;'>" + textStatus + "</li>");
                  }
                });
            }
        });
    });

    $("#uploadBtnRoom").click(function()
    {
        $('#room_upload').each(function(index, value)
        {
            var file = value.files;
            if(file)
            {
                var formData = new FormData();
                var token = JSON.parse(atob(localStorage.getItem('JWT').split('.')[1]));

            		for(var f = 0; f < file.length; f++){
            			formData.append('photos', file[f]);
            		}
                $.ajax({
                  url : 'http://localhost:3000/upload/users/'+token.rid+'/homes/'+token.hid+'/rooms/188/photo',
                  type : 'POST',
                  data : formData,
                  cache : false,
                  contentType : false,
                  processData : false,
                  beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('JWT'))},
                  success : function(data, textStatus, jqXHR) {
                        var message = jqXHR.responseText;
                        $("#messages").append("<li>" + message + "</li>");
                  },
                  error : function(jqXHR, textStatus, errorThrown) {
                        $("#messages").append("<li style='color: red;'>" + textStatus + "</li>");
                  }
                });
            }
        });
    });

    $("#uploadBtnHome").click(function()
    {
        $('#home_upload').each(function(index, value)
        {
            var file = value.files;
            if(file)
            {
                var formData = new FormData();
                var token = JSON.parse(atob(localStorage.getItem('JWT').split('.')[1]));

            		for(var f = 0; f < file.length; f++){
            			formData.append('photos', file[f]);
            		}
                $.ajax({
                  url : 'http://localhost:3000/upload/users/'+token.rid+'/homes/'+token.hid+'/photos',
                  type : 'POST',
                  data : formData,
                  cache : false,
                  contentType : false,
                  processData : false,
                  beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('JWT'))},
                  success : function(data, textStatus, jqXHR) {
                        var message = jqXHR.responseText;
                        $("#messages").append("<li>" + message + "</li>");
                  },
                  error : function(jqXHR, textStatus, errorThrown) {
                        $("#messages").append("<li style='color: red;'>" + textStatus + "</li>");
                  }
                });
            }
        });
    });
});
</script>
<h1>Test Upload</h1>

<form action="rest/upload/pdf" method="post" enctype="multipart/form-data">

    <p>
        Select profile files: <input id="user_upload" type="file" name="file" size="45"  multiple/>
    </p>
    <p>
        <input id="uploadBtn" type="button" value="Upload Files" />
    </p>

    <p>
        Select room files: <input id="room_upload" type="file" name="file" size="45"  multiple/>
    </p>
    <p>
        <input id="uploadBtnRoom" type="button" value="Upload Files" />
    </p>

    <p>
        Select home files: <input id="home_upload" type="file" name="file" size="45"  multiple/>
    </p>
    <p>
        <input id="uploadBtnHome" type="button" value="Upload Files" />
    </p>

</form>

<ul id="messages">
</ul>

</body>
</html>
